# atomiccounter -- 高并发写入性能的计数器

[English](README.md) | 简体中文

[![License Apache 2.0](https://img.shields.io/badge/License-Apache_2.0-red.svg)](COPYING)
[![Golang](https://img.shields.io/badge/Language-go1.18+-blue.svg)](https://go.dev/)
![Build Status](https://github.com/chen3feng/atomiccounter/actions/workflows/go.yml/badge.svg)
[![Coverage Status](https://coveralls.io/repos/github/chen3feng/atomiccounter/badge.svg?branch=master)](https://coveralls.io/github/chen3feng/atomiccounter?branch=master)
[![GoReport](https://goreportcard.com/badge/github.com/securego/gosec)](https://goreportcard.com/report/github.com/chen3feng/atomiccounter)
[![Go Reference](https://pkg.go.dev/badge/github.com/chen3feng/atomiccounter.svg)](https://pkg.go.dev/github.com/chen3feng/atomiccounter)

本库实现了一个针对高并发写入进行性能优化的计数器。类似于 Java 里的 [LongAdder](https://segmentfault.com/a/1190000023761290)，
[folly](https://github.com/facebook/folly) 里的 [ThreadCachedInt](https://github.com/facebook/folly/blob/main/folly/docs/ThreadCachedInt.md)，
在高并发写入但是读取很少的应用下，可以提供高达 `sync/atomic` 几十倍的写入性能。

性能压测（每 100 次调用）：

```console
BenchmarkNonAtomicAdd-10        47337121                22.14 ns/op
BenchmarkAtomicAdd-10             180942              6861 ns/op
BenchmarkCounter-10             14871549                81.02 ns/op
```

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# atomiccounter

```go
import "github.com/chen3feng/atomiccounter"
```

## Index

- [type Int64](<#type-int64>)
  - [func NewInt64() *Int64](<#func-newint64>)
  - [func (c *Int64) Add(i int64)](<#func-int64-add>)
  - [func (c *Int64) Clear(i int64)](<#func-int64-clear>)
  - [func (c *Int64) Inc(i int64)](<#func-int64-inc>)
  - [func (c *Int64) Load() int64](<#func-int64-load>)
  - [func (c *Int64) Set(n int64)](<#func-int64-set>)
  - [func (c *Int64) Swap(n int64) int64](<#func-int64-swap>)


## type [Int64](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L11-L18>)

```go
type Int64 struct {
    // contains filtered or unexported fields
}
```

### func [NewInt64](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L20>)

```go
func NewInt64() *Int64
```

### func \(\*Int64\) [Add](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L24>)

```go
func (c *Int64) Add(i int64)
```

### func \(\*Int64\) [Clear](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L45>)

```go
func (c *Int64) Clear(i int64)
```

### func \(\*Int64\) [Inc](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L34>)

```go
func (c *Int64) Inc(i int64)
```

### func \(\*Int64\) [Load](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L50>)

```go
func (c *Int64) Load() int64
```

Load return the current value.

### func \(\*Int64\) [Set](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L38>)

```go
func (c *Int64) Set(n int64)
```

### func \(\*Int64\) [Swap](<https://github.com/chen3feng/atomiccounter/blob/master/int64.go#L59>)

```go
func (c *Int64) Swap(n int64) int64
```

Swap returns the current value and swap it with n.



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->
